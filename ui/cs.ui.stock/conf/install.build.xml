<?xml version="1.0" encoding="UTF-8"?>
<!-- Ant build file for cs -->

<project basedir="." default="info" name="CS STOCK">

  <import file="../../common.xml"/>

  <property name="component.name" value="stock" />
  <property name="app.name" value="CS STOCK" />
  <property name="version" value="@VERSION@"/>
  <property name="noeditwarning" value="This file is automatically generated. Your changes will be lost on next installation." />

  <target name="install-dist" depends="check-if-configured">
    <!-- set oracle port to default, if it isn't set -->
    <antcall target="install-copy">
      <param name="core.path" value="${core.path}"/>
    </antcall>
    <echo message="${app.name} has been successfully installed in Core" />
  </target>

  <target name="compile-config">
    <copy file="conf/persistence.xml.fragments/stock.persistence.xml.template" tofile="conf/persistence.xml.fragments/stock.xml" overwrite="true">
        <filterset>
            <filter token="JDBC_URL" value="${stockdb.url}"/>
            <filter token="JDBC_USER" value="${stockdb.user}"/>
        </filterset>
    </copy>
  </target>

  <target name="install-copy"
    description="Configure and copy component in Tieto Card Suite Core application"
    depends="compile-config">
    <copy todir="${core.path}/webapp" overwrite="true">
      <fileset dir="webapp" excludes="**/${component.name}.links" />
    </copy>
    <copy todir="${core.path}/conf" overwrite="true">
      <fileset dir="conf" excludes="**/${component.name}.links" />
    </copy>
    
    <move todir="${core.path}/webapp/apps/${component.name}">
      <fileset dir="${core.path}/webapp/apps/${component.name}" />
    </move>
    <copy todir="${core.path}/webapp" overwrite="true">
      <fileset dir="webapp" excludes="**/stock.links" />
    </copy>
      <copy todir="${core.path}/conf" overwrite="true">
      <fileset dir="conf" excludes="**/stock.links" />
    </copy>
    <move todir="${core.path}/webapp/apps/stock">
      <fileset dir="${core.path}/webapp/apps/stock" />
    </move>
  </target>


</project>
